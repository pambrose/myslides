<!DOCTYPE html>
<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
    
    <link href="revealjs/dist/reveal.css" rel="stylesheet">
    <link href="revealjs/dist/reset.css" rel="stylesheet">
    <link href="revealjs/dist/theme/solarized.css" id="theme" rel="stylesheet">
    <link href="revealjs/plugin/highlight/monokai.css" id="highlight-theme" rel="stylesheet">
    <link href="revealjs/plugin/copycode/copycode.css" rel="stylesheet">
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="/favicon.ico" rel="icon" type="image/x-icon">
    
    <style media="screen" type="text/css">
			/* These CSS settings are embedded directly in the presentation html */
		
			/* This prevents auto-capitalization of headers */
			.reveal h1,
			.reveal h2,
			.reveal h3,
			.reveal h4,
			.reveal h5,
			.reveal h6 {
			    text-transform: none;
			}
		
			a.top-left {
			    position: absolute;
			    z-index: 1;
			    width: clamp(50px, 8vmax, 80px);
			    line-height: 0;
			    color: rgba(255, 255, 255, 0.5);
			}
		
			a.top-left path {
			    fill: #258bd2;
			}
		
			a.top-left:hover {
			    color: white;
			}
		
			a.top-right {
			    position: absolute;
			    top: 15px;
			    right: 15px;
			    z-index: 1;
			}
		</style>
    
    <style media="screen" type="text/css">
			#githubCorner path { fill: #258BD2; }
			
			.smallText {
			  padding-bottom: 20px;
			}
			.smallText li {
			  font-size: 0.8em;
			}
			
			.multiColumn2:after {
			content: '';
			display: table;
			clear: both;
			}
			.column2 {
			float: left;
			width: 50%;
			}
			.column2 li {
			margin-bottom: 10px;
			}
			
		</style>
    
  </head>
  <body>
    <div class="reveal">
      <a class="top-left" href="https://github.com/pambrose/myslides" target="_blank" title="View presentation source on Github">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 55 55">
                    
          <path d="M27.5 11.2a16.3 16.3 0 0 0-5.1 31.7c.8.2 1.1-.3 1.1-.7v-2.8c-4.5 1-5.5-2.2-5.5-2.2-.7-1.9-1.8-2.4-1.8-2.4-1.5-1 .1-1 .1-1 1.6.1 2.5 1.7 2.5 1.7 1.5 2.5 3.8 1.8 4.7 1.4.2-1 .6-1.8 1-2.2-3.5-.4-7.3-1.8-7.3-8 0-1.8.6-3.3 1.6-4.4-.1-.5-.7-2.1.2-4.4 0 0 1.4-.4 4.5 1.7a15.6 15.6 0 0 1 8.1 0c3.1-2 4.5-1.7 4.5-1.7.9 2.3.3 4 .2 4.4 1 1 1.6 2.6 1.6 4.3 0 6.3-3.8 7.7-7.4 8 .6.6 1.1 1.6 1.1 3v4.6c0 .4.3.9 1.1.7a16.3 16.3 0 0 0-5.2-31.7" fill="currentColor" stroke="none"></path>
                  
        </svg>
              </a>
			<a class="top-right" href="#/redis" target="_self" title="Go to 1st Slide">&#127968;</a>

      <div class="slides">
        <section id="redis">
          <h2>Redis Basics</h2>
          <a href="https://redis.io" target="_blank"><img src="images/redis/redis.png" width="250px"></a><a href="https://pambrose.github.io/myslides/redis.html">https://pambrose.github.io/myslides/redis.html</a>
        </section>
        
        <section>
          <h3>&#128367; Overview of Slides</h3>
          <ul style="font-size:30px; padding-left: 80px">
            <li>
              <a href="https://redis.io/docs/getting-started/" target="_blank">Getting Redis up and running</a>
            </li>
            <li>Problem Statement</li>
            <li>What is Redis?</li>
            <li>
              <a href="https://redis.io/docs/data-types/" target="_blank">Data Types</a>
            </li>
            <li>
              <a href="https://redis.io/commands/" target="_blank">Redis Commands</a>
            </li>
            <li>
              <a href="https://redis.io/docs/clients/" target="_blank">Programmatic APIs</a>
            </li>
            <li>Use Cases</li>
            <li>
              <a href="https://redis.io/docs/manual/pubsub/" target="_blank">Pub/Sub</a>
            </li>
          </ul>
        </section>
        
        <section data-markdown="">
          <script type="text/template">
## OSX Install for Redis Client and Server

```bash

$ brew install redis iredis    
         

```    
      
#### [Other Platforms](https://redis.io/docs/getting-started/installation/)      
</script>
        </section>
        
        <section data-markdown="">
          <script type="text/template">
## Start a Redis Server

```bash

$ docker run -d -p 6379:6379 --name myredis redis


``` 
or   
     
```bash

$ redis-server      


```                    
</script>
        </section>
        
        <section data-markdown="">
          <script type="text/template">
## Start a Redis Client
                 
```bash

$ redis-cli      


```    
or
```bash

$ iredis      


```                
</script>
        </section>
        
        <section>
          <h3>‚ùìWhat Problems Are We Trying To Solve?</h3>
          <ul style="font-size:30px; padding-left: 80px">
            <li>Anyone with a credit card buy 100 servers</li>
            <li>How do we orchestrate them?</li>
            <li>How do we share data among them?</li>
            <li>How do we distribute work?</li>
            <li>How do we collect results?</li>
            <li>How do we count things?</li>
            <li>How do we elect leaders?</li>
            <li>How do we ensure availability?</li>
          </ul>
        </section>
        
        <section>
          <h3>&#128294; What is Redis?</h3>
          <ul style="font-size:30px; padding-left: 80px">
            <li>REmote DIctionary Server</li>
            <li>Fast NoSQL database written in ANSI C</li>
            <li>An in-memory database -- all data is stored in RAM</li>
            <li>Based on the key-value model</li>
            <li>All access is via a key</li>
            <li>Meant to be run as a network-attached server</li>
            <li>Simple TCP protocol, which is implemented in many languages</li>
            <li>Can act as a cache, database, message broker, and pub/sub engine</li>
            <li>One of many possible solutions in this space</li>
          </ul>
        </section>
        
        <section>
          <h2>High Level Architecture</h2>
          <div class="mermaid">flowchart TB
S1("Server 1&amp;nbsp;") --&gt; R["Redis&amp;nbsp;"]
S2("Server 2&amp;nbsp;") --&gt; R
S3("Server 3&amp;nbsp;") --&gt; R 
S4("Server 4&amp;nbsp;") --&gt; R 
S5("Server 5&amp;nbsp;") --&gt; R 
style R fill:#f66,stroke:#000,stroke-width:1px</div>
        </section>
        
        <section>
          <h2 style="margin-bottom:20px;">&#129517; Redis DataTypes</h2>
          <div class="multiColumn2">
            <div class="column2">
              <ul style="font-size:30px; padding-top:10px;">
                <li>
                  <a href="https://redis.io/docs/data-types/strings/" target="_blank">Strings</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/lists/" target="_blank">Lists</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/sets/" target="_blank">Sets</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/hashes/" target="_blank">Hashes</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/sorted-sets/" target="_blank">Sorted Sets</a>
                </li>
              </ul>
            </div>
            <div class="column2">
              <ul style="font-size:30px; padding-top:10px;">
                <li>
                  <a href="https://redis.io/docs/data-types/streams/" target="_blank">Streams</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/geospatial/" target="_blank">Geospatial</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/hyperloglogs/" target="_blank">HyperLogLog</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/bitmaps/" target="_blank">Bitmaps</a>
                </li>
                <li>
                  <a href="https://redis.io/docs/data-types/bitfields/" target="_blank">Bitfields</a>
                </li>
              </ul>
            </div>
          </div>
        </section>
        
        <section>
          <h2 style="margin-bottom:20px;">
            &#128652; <a href="https://redis.io/commands/" target="_blank">Redis Commands</a>
          </h2>
          <div class="multiColumn2">
            <div class="column2">
              <ul style="font-size:30px; padding-top:10px;">
                <li>SET/GET/DEL</li>
                <li>EXPIRE/PERSIST</li>
                <li>MSET/MGET</li>
                <li>INCR/DECR</li>
              </ul>
            </div>
            <div class="column2">
              <ul style="font-size:30px; padding-top:10px;">
                <li>LPUSH/LPOP/RPOP/LLEN</li>
                <li>SADD/SMEMBERS/SISMEMBER</li>
                <li>SINTER/SCARD</li>
                <li>HSET/HGET/HGETALL</li>
              </ul>
            </div>
          </div>
        </section>
        
        <section>
          <h1>
            <a href="https://redis.io/docs/data-types/strings/" target="_blank">Redis Strings</a>
          </h1>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/set/" target="_blank">SET</a>/<a href="https://redis.io/commands/get/" target="_blank">GET</a>/<a href="https://redis.io/commands/del/" target="_blank">DEL</a> Commands
          </h2>
          <h4>Set, get, and delete keys</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6|7-8|9-10|11-12" data-noescape="" data-trim="">
&gt; SET key1 "Hello"
OK
&gt; SET key2 "World"
OK
&gt; GET key1
"Hello"
&gt; GET key2
"World"
&gt; DEL key1 key2
(integer) 2
&gt; GET key1
(nil)
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/expire/" target="_blank">EXPIRE</a>/<a href="https://redis.io/commands/persist/" target="_blank">PERSIST</a> Commands
          </h2>
          <h4>Expiring keys (1)</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6|7-8" data-noescape="" data-trim="">
&gt; set key1 "Hello"
OK
&gt; expire key1 5
(integer) 1
&gt; get key1 (immediately)
"Hello"
&gt; get key1 (after some time)
(nil)
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/set/" target="_blank">SET</a> Command Options
          </h2>
          <h4>Expiring keys (2)</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6" data-noescape="" data-trim="">
&gt; SET tempkey "Temp val with 10 secs of life" EX 10
OK
&gt; SET cond1key "Set only if key does not exist" EX 10 NX
OK
&gt; SET cond2key "Set only if key does exist" EX 10 XX
OK
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/mset/" target="_blank">MSET</a>/<a href="https://redis.io/commands/mget/" target="_blank">MGET</a> Commands
          </h2>
          <h4>Set/Get multiple values</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-7" data-noescape="" data-trim="">
&gt; MSET key1 "Hello" key2 "World"
OK
&gt; MGET key1 key2 key3 key4
1) "Hello"
2) "World"
3) (nil)
4) (nil)
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/incr/" target="_blank">INCR</a>/<a href="https://redis.io/commands/incrby/" target="_blank">INCRBY</a> Commands
          </h2>
          <h4>Increment a value (atomically)</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6|7-8|9-10|11-12" data-noescape="" data-trim="">
&gt; SET mykey "10"
OK
&gt; INCR key1
(integer) 11
&gt; GET key1
"11"
&gt; INCRBY key1 10
(integer) 21
&gt; GET key1
"21"
&gt; INCR key2
(integer) 1
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/decr/" target="_blank">DECR</a>/<a href="https://redis.io/commands/decrby/" target="_blank">DECRBY</a> Commands
          </h2>
          <h4>Decrement a value (atomically)</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6|7-8|9-10|11-12" data-noescape="" data-trim="">
&gt; SET key1 "10"
OK
&gt; DECR key1
(integer) 9
&gt; GET key1
"9"
&gt; DECRBY key1 5
(integer) 4
&gt; GET key1
"4"
&gt; DECR key2
(integer) -1
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h1>
            <a href="https://redis.io/docs/data-types/lists/" target="_blank">Redis Lists</a>
          </h1>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/lpush/" target="_blank">LPUSH</a>/<a href="https://redis.io/commands/rpop/" target="_blank">RPOP</a>/<a href="https://redis.io/commands/llen/" target="_blank">LLEN</a> Commands
          </h2>
          <h4>Implementing a queue (first in, first out)</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6|7-8|9-10|11-12" data-noescape="" data-trim="">
&gt; LPUSH work:queue:ids 101
(integer) 1
&gt; LPUSH work:queue:ids 237
(integer) 2
&gt; LLEN work:queue:ids
(integer) 2
&gt; RPOP work:queue:ids
"101"
&gt; RPOP work:queue:ids
"237"
&gt; LLEN work:queue:ids
(integer) 0
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/lpush/" target="_blank">LPUSH</a>/<a href="https://redis.io/commands/lpop/" target="_blank">LPOP</a> Commands
          </h2>
          <h4>Implementing a stack (first in, last out)</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6|7-8" data-noescape="" data-trim="">
&gt; LPUSH work:queue:ids 101
(integer) 1
&gt; LPUSH work:queue:ids 237
(integer) 2
&gt; LPOP work:queue:ids
"237"
&gt; LPOP work:queue:ids
"101"
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/blpop/" target="_blank">BLPOP</a> Command
          </h2>
          <h4>Blocking list pop</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1|2-3|4|5-6|7|8-9|" data-noescape="" data-trim="">
&gt; BLPOP work:ids 0
1) "work:ids"
2) "444"
&gt; BLPOP work:ids 5
(nil)
(5.03s)
&gt; BLPOP work:ids1 work:ids2 0
1) "work:ids2"
2) "555"
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h1>
            <a href="https://redis.io/docs/data-types/sets/" target="_blank">Redis Sets</a>
          </h1>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/sadd/" target="_blank">SADD</a>/<a href="https://redis.io/commands/smembers/" target="_blank">SMEMBERS</a>/<a href="https://redis.io/commands/scard/" target="_blank">SCARD</a> Commands
          </h2>
          <h4>Set creation and membership</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-6|7-10|11-12" data-noescape="" data-trim="">
&gt; SADD user:123:favorites 347
(integer) 1
&gt; SADD user:123:favorites 561 742
(integer) 2
&gt; SADD user:456:favorites 561
(integer) 1
&gt; SMEMBERS user:123:favorites
1) "347"
2) "561"
3) "742"
&gt; SCARD user:123:favorites
(integer) 3
&gt;&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/sismember/" target="_blank">SISMEMBER</a> Command
          </h2>
          <h4>Set membership: does user 123 like books 742 and 299?</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4" data-noescape="" data-trim="">
&gt; SISMEMBER user:123:favorites 742
(integer) 1
&gt; SISMEMBER user:123:favorites 299
(integer) 0
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/sinter/" target="_blank">SINTER</a> Command
          </h2>
          <h4>Set intersection: do users 123 and 456 have any favorite books in common?</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="" data-noescape="" data-trim="">
&gt; SINTER user:123:favorites user:456:favorites
1) "561"
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h1>
            <a href="https://redis.io/docs/data-types/hashes/" target="_blank">Redis Hashes</a>
          </h1>
        </section>
        
        <section>
          <h2>
            <a href="https://redis.io/commands/hset/" target="_blank">HSET</a>/<a href="https://redis.io/commands/hget/" target="_blank">HGET</a>/<a href="https://redis.io/commands/hgetall/" target="_blank">HGETALL</a> Commands
          </h2>
          <h4>Save a basic user profile as a hash</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|3-4|5-11" data-noescape="" data-trim="">
&gt; HSET user:123 username martina firstName Martina lastName Elisa
(integer) 3
&gt; HGET user:123 username
"martina"
&gt; HGETALL user:123
1) "username"
2) "martina"
3) "firstName"
4) "Martina"
5) "lastName"
6) "Elisa"
</code>
          </pre>
        </section>
        
        <section>
          <h1>
            <a href="https://redis.io/docs/clients/" target="_blank">Programmatic APIs</a>
          </h1>
        </section>
        
        <section>
          <h2>
            <a href="https://github.com/redis/jedis" target="_blank">Jedis</a> Example (SET/GET/DEL)
          </h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1|3|5-6|8|10-11" data-noescape="" data-trim="">
val jedis = JedisPooled("localhost", 6379)

jedis.set("key1", "Hello");

val v1 = jedis.get("key1")
println("key1=$v1")

jedis.del("key1")

val v2 = jedis.get("key1")
println("key1=$v2")
</code>
          </pre>
        </section>
        
        <section>
          <h2>
            <a href="https://github.com/redis/jedis" target="_blank">Jedis</a> Example (HSET/HGETALL)
          </h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1|3-10|12-13" data-noescape="" data-trim="">
val jedis = JedisPooled("localhost", 6379)

jedis.hset(
  "user:123",
  mapOf(
    "username" to "martina",
    "firstName" to "Martina",
    "lastName" to "Elisa",
  )
)

val valMap: Map&lt;String, String&gt; = jedis.hgetAll("user:123")
println("user:123=$valMap")
</code>
          </pre>
        </section>
        
        <section>
          <h1>Use Cases</h1>
        </section>
        
        <section>
          <h2>Session Cache</h2>
          <div class="mermaid">flowchart TD
WC1("Web Client 1&amp;nbsp;") &lt;--&gt; LB("Load Balancer&amp;nbsp;")
WC2("Web Client 2&amp;nbsp;") &lt;--&gt; LB
WC3("Web Client 3&amp;nbsp;") &lt;--&gt; LB
LB &lt;--&gt; S1("HTTP Server 1&amp;nbsp;") &amp; S2("HTTP Server 2&amp;nbsp;") &amp; S3("HTTP Server 3&amp;nbsp;")
S1 &amp; S2 &amp; S3 &lt;--&gt; R("Redis&amp;nbsp;")
style R fill:#f66,stroke:#000,stroke-width:1px</div>
          <h4>Cache user profiles, high scores, page hits, shopping cart items, last 10 user posts</h4>
          <h4>Rate Limiter</h4>
        </section>
        
        <section>
          <h2>Saving User Profile using HSET</h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1-5|7-11|12|13|15|16|17" data-noescape="" data-trim="">
data class User(val map: Map&lt;String, String&gt;) {
  val username: String by map
  val firstName: String by map
  val lastName: String by map
}

val map1 = mapOf(
  "username" to "martina",
  "firstName" to "Martina",
  "lastName" to "Elisa",
)
val user1 = User(map1)
jedis.hset("user:123", user1.map)

val map2 = jedis.hgetAll("user:123")
val user2 = User(map2)
println("user2=$user2")
</code>
          </pre>
        </section>
        
        <section>
          <h2>Saving User Profile using SET</h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1-6|8|9|10|12|13|14" data-noescape="" data-trim="">
@Serializable
data class User(
  val username: String,
  val firstName: String,
  val lastName: String
)

val user1 = User("martina", "Martina", "Elisa")
val json1 = Json.encodeToString(user1)
jedis.set("user:123", json1)

val json2 = jedis.get("user:123")
val user2 = Json.decodeFromString&lt;User&gt;(json2)
println("user2=$user2")
</code>
          </pre>
        </section>
        
        <section>
          <h2>Naive Rate Limiter using INCR (1)</h2>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1|2|3|4-7|8|9-10|11-13" data-noescape="" data-trim="">
FUNCTION LIMIT_API_CALL(ip)
ts = CURRENT_UNIX_TIME() // second resolution
keyname = ip+":"+ts
MULTI
    INCR(keyname)
    EXPIRE(keyname, 10)
EXEC
current = RESPONSE_OF_INCR_WITHIN_MULTI
IF current &gt; 10 THEN
    ERROR "Too many requests per second"
ELSE
    PERFORM_API_CALL()
END
</code>
          </pre>
          <h4>Limit each IP to 10 requests/sec</h4>
        </section>
        
        <section>
          <h2>Naive Rate Limiter using INCR (2)</h2>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1|2|3-4|5|6-9|10|11" data-noescape="" data-trim="">
FUNCTION LIMIT_API_CALL(ip):
current = GET(ip)
IF current != NULL AND current &gt; 10 THEN
    ERROR "Too many requests per second"
ELSE
    value = INCR(ip)
    IF value == 1 THEN
        EXPIRE(ip, 1)
    END
    PERFORM_API_CALL()
END
</code>
          </pre>
          <h4>Limit each IP to 10 requests/sec</h4>
        </section>
        
        <section>
          <h2>Naive Rate Limiter using a List</h2>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1|2|3-4|5|6|7-10|11-13|14|15" data-noescape="" data-trim="">
FUNCTION LIMIT_API_CALL(ip)
current = LLEN(ip)
IF current &gt; 10 THEN
    ERROR "Too many requests per second"
ELSE
    IF EXISTS(ip) == FALSE
        MULTI
            RPUSH(ip,ip)
            EXPIRE(ip,1)
        EXEC
    ELSE
        RPUSHX(ip,ip)
    END
    PERFORM_API_CALL()
END
</code>
          </pre>
          <h4>Limit each IP to 10 requests/sec</h4>
        </section>
        
        <section>
          <h2>Work Distribution</h2>
          <div class="mermaid">flowchart TD
WS["Work Submitter&amp;nbsp;"] --&gt; R["Redis&amp;nbsp;"]
R &lt;--&gt; S1["Work Executor 1&amp;nbsp;"] &amp; S2["Work Executor 2&amp;nbsp;"] &amp; S3["Work Executor 3&amp;nbsp;"]
style R fill:#f66,stroke:#000,stroke-width:1px</div>
          <h4>Distribute compute-intensive jobs</h4>
        </section>
        
        <section>
          <h2>Submit Work</h2>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1|2" data-noescape="" data-trim="">
FUNCTION SUBMIT_WORK_TO_QUEUE(work_desc)
LPUSH("work_queue:render", work_desc)
</code>
          </pre>
        </section>
        
        <section>
          <h2>Execute Work</h2>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1|2,5|3|4" data-noescape="" data-trim="">
FUNCTION REMOVE_WORK_FROM_QUEUE()
WHILE true
  work_desc = BRPOP("work_queue:render")
  EXECUTE_WORK(word_desc)
END
</code>
          </pre>
        </section>
        
        <section>
          <h2>WorkDesc Class</h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1,15|2-6|8-9|11-12|14" data-noescape="" data-trim="">
@Serializable
data class WorkDesc(
  val jobId: Int,
  val timeRequired: Int
)
</code>
          </pre>
        </section>
        
        <section>
          <h2>Submit Work</h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1,15|2-6|8-9|11-12|14" data-noescape="" data-trim="">
repeat(10000) {
  val workDesc = WorkDesc(cnt++, Random.nextInt(1, 15))
  println("Submitting work item: $workDesc")
  val json = Json.encodeToString(workDesc)
  jedis.lpush("work_queue:render", json)
  Thread.sleep(1000)
}
</code>
          </pre>
        </section>
        
        <section>
          <h2>Execute Work</h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1,15|2-6|8-9|11-12|14" data-noescape="" data-trim="">
val workerCount = 5
val executor = Executors.newCachedThreadPool()
val workers = List(workerCount) { Worker(it) }
workers.forEach { worker -&gt;
  executor.submit {
    while (true) {
      val workDesc = worker.removeWorkFromQueue("work_queue:render")
      worker.executeWork(workDesc)
    }
  }
}
</code>
          </pre>
        </section>
        
        <section>
          <h1>
            <a href="https://redis.io/docs/manual/pubsub/" target="_blank">Redis Pub/Sub</a>
          </h1>
        </section>
        
        <section>
          <h3>
            <a href="https://redis.io/commands/subscribe/" target="_blank">SUBSCRIBE</a>/<a href="https://redis.io/commands/unsubscribe/" target="_blank">UNSUBSCRIBE</a>/<a href="https://redis.io/commands/publish/" target="_blank">PUBLISH</a> Commands
          </h3>
          <h4>Event-based programming</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-3|5-6|4" data-noescape="" data-trim="">
&gt; SUBSCRIBE topic1 topic2
subscribe from topic1: 1
subscribe from topic2: 2
message   from topic1: Hello
&gt; PUBLISH topic1 "Hello"
(integer) 1
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h3>
            <a href="https://redis.io/commands/psubscribe/" target="_blank">PSUBSCRIBE</a>/<a href="https://redis.io/commands/punsubscribe/" target="_blank">PUNSUBSCRIBE</a> Commands
          </h3>
          <h4>Pattern-matching subscriptions</h4>
          <pre data-cc="false"><code class="bash" data-line-numbers="|1-2|5-6|3|7-8|4" data-noescape="" data-trim="">
&gt; PSUBSCRIBE weather.*
psubscribe from weather.*: 1
pmessage  from weather.*:weather.94528: 88
pmessage  from weather.*:weather.94513: 70
&gt; PUBLISH weather.94528 88
(integer) 1
&gt; PUBLISH weather.94513 70
(integer) 1
&gt;
</code>
          </pre>
        </section>
        
        <section>
          <h2>Stock Ticker Prices</h2>
          <div class="mermaid">flowchart TB
WC1("Web Client 1&amp;nbsp;") &amp; WC2("Web Client 2&amp;nbsp;") &amp; WC3("Web Client 3&amp;nbsp;") &lt;--&gt; WS("Web Server&amp;nbsp;")
WS &lt;--&gt; R("Redis&amp;nbsp;")
R &lt;--&gt; PS1("NYSE\nPrice Source&amp;nbsp;") &amp; PS2("NASDAQ\nPrice Source&amp;nbsp;") &amp; PS3("CBOT\nPrice Source&amp;nbsp;")
style R fill:#f66,stroke:#000,stroke-width:1px</div>
          <h4>Distributing stock ticker prices</h4>
        </section>
        
        <section>
          <h2>Publish Stock Prices</h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1,15|2-6|8-9|11-12|14" data-noescape="" data-trim="">
repeat(200) {
  val stock = Stocks.values()[Random.nextInt(size)].name
  val priceChannel = "stocks:price:$stock"
  val volumeChannel = "stocks:volume:$stock"
  val price = Random.nextInt(32, 100)
  val volume = Random.nextInt(1000, 2000)

  println("Publishing $priceChannel price $price")
  jedis.publish(priceChannel, price.toString())

  println("Publishing $volumeChannel volume $volume")
  jedis.publish(volumeChannel, volume.toString())

  Thread.sleep(500)
}
</code>
          </pre>
        </section>
        
        <section>
          <h2>Subscribe to a Stock Price</h2>
          <pre data-cc="false"><code class="kotlin" data-line-numbers="|1-11|2-4|13-15|17-19|21" data-noescape="" data-trim="">
class MyListener : JedisPubSub() {
  override fun onMessage(channel: String, msg: String) {
    println("Received a message for channel $channel: $msg")
  }

  override fun onSubscribe(channel: String, count: Int) {}
  override fun onUnsubscribe(channel: String, count: Int) {}
  override fun onPSubscribe(pattern: String, count: Int) {}
  override fun onPUnsubscribe(pattern: String, count: Int) {}
  override fun onPMessage(pattern: String, channel: String, msg: String) {}
}

executor.submit {
  jedis.subscribe(MyListener(), "stocks:price:AAPL")
}

executor.submit {
  jedis.subscribe(MyListener(), "stocks:volume:GOOG")
}

Thread.sleep(100000)
</code>
          </pre>
        </section>
        
      </div>
    </div>
    	
	<script src="revealjs/dist/reveal.js"></script>
	<script src="revealjs/plugin/zoom/zoom.js"></script>
	<script src="revealjs/plugin/search/search.js"></script>
	<script src="revealjs/plugin/markdown/markdown.js"></script>
	<script src="revealjs/plugin/highlight/highlight.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
	<script src="revealjs/plugin/copycode/copycode.js"></script>
	<script src="revealjs/plugin/menu/menu.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

	<script>
		Reveal.initialize({
			history: true,
			transition: 'slide',
			transitionSpeed: 'slow',

			slideNumber: 'c/t',

			plugins: [ RevealZoom, RevealSearch, RevealMarkdown, RevealHighlight, RevealMenu, CopyCode ]
		});


		mermaid.initialize({startOnLoad:true});

</script>
  </body>
</html>

